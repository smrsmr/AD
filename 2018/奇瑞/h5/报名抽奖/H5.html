<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>奇瑞H5</title>
		<link rel="icon" type="image/x-icon" href="http://mat1.gtimg.com/www/icon/favicon2.ico">
		<style type="text/css">
			@media only screen and (max-width: 414px), only screen and (max-device-width:414px) {
			    html,body { font-size:129.375px; }
			}
			@media only screen and (max-width: 412px), only screen and (max-device-width:414px) {
			    html,body { font-size:128.75px; }
			}
			@media only screen and (max-width: 400px), only screen and (max-device-width:400px) {
			    html,body { font-size:125px; }
			}
			@media only screen and (max-width: 375px), only screen and (max-device-width:375px) {
			 	html,body{font-size: 117.1875px;}
		 	}
		 	@media only screen and (max-width: 360px), only screen and (max-device-width:360px) {
		    	html,body { font-size:112.5px; }
			}
			@media only screen and (max-width: 320px), only screen and (max-device-width:320px) {
			    html,body { font-size:100px; }
			}
			*{padding: 0;margin: 0;}
			html,body{font-family: "微软雅黑";height: 100%;width: 100%;}
			h1,h2,h3,h4,h5,div,span,p,ul,ol,dl,dt,dd,a,input,img,select{list-style: none;border: 0;font-weight: normal;outline: none;}
			.luck{width: 100%;height: 100%;background: url('http://img1.gtimg.com/autoguangzhou/pics/hv1/168/110/207/13488393.jpg') top no-repeat;background-size: 100%;font-size: 0.16rem;overflow: hidden;}
			.ml-main {  width: 100%;  height: 100%;  max-width: 640px;  position: absolute;  overflow: hidden;  left: 0;  top: 0;  *zoom: 1;  z-index: 1;  }
			.ml-main .kePublic {  width: 80%;  height: auto;  position: absolute;  bottom: 52%;  left: 10%;  }
			.banner {  display: block;  width: 95%;  margin-left: auto;  margin-right: auto;  }
			.banner .turnplate {  display: block;  width: 100%;  position: relative;  }
			.banner .turnplate canvas.item {  width: 100%;  }
			.banner .turnplate #go {  position: absolute;  width: 0.5rem;  height: 0.8rem;  left: 0.96rem;  top: 0.68rem;  border: 0;  background: none;  }
			.banner .turnplate #tupBtn {  position: absolute;  width: 2rem;  height: 0.5rem;  left: 0.25rem;  top: 2.7rem;  border: 0;  background: none;  }
			.banner .turnplate img {  width: 100%;  height: auto;  }
			@media only screen and (max-width: 320px) {
				.ml-main .kePublic {
					width: 80%;
					height: auto;
					position: absolute;
					bottom: 47%;
					left: 10%;
				}
			}
			.baoming{width: 100%;height: 100%;background: url('http://img1.gtimg.com/autoguangzhou/pics/hv1/126/110/207/13488351.jpg') top no-repeat;background-size: 100%;font-size: 0.16rem;overflow: hidden;}
			.baoming-contain{margin-top: 0.73rem;margin-left: 1rem;}
			input[type=text],select{width: 1.62rem;height: 0.26rem;margin-bottom: 0.19rem;box-sizing: border-box;vertical-align: top;background: transparent}
			#button{width: 1.4rem;height: 0.35rem;background: transparent}
			@media only screen and (min-width: 414px), only screen and (min-device-width:414px) {
				input[type=text], select{height: 0.27rem;}
			}
		</style>
	</head>
	<body>
	<div class="baoming" style="display: block">
		<div class="baoming-contain">
			<input type="text" name="" id="name"  value="" placeholder="请输入您的姓名"/><br />
			<input type="text" name="" id="phone" value="" placeholder="请输入您的电话" maxlength="11"/><br />
			<select name="" id="identity">
				<option value="0">-请选择身份-</option>
				<option value="车主">车主</option>
				<option value="乘客">乘客</option>
			</select><br />
			<select name="" id="model">
				<option value="0">-请选择车型-</option>
				<option value="瑞虎7">瑞虎7</option>
				<option value="艾瑞泽5">艾瑞泽5</option>
				<option value="艾瑞泽7">艾瑞泽7</option>
				<option value="瑞虎5x">瑞虎5x</option>
			</select>
			<br />
			<input type="button" name="" id="button" value="" />
		</div>
	</div>
	<div class="luck" style="display: none">
			<div class="ml-main" id="ml-main">
				<div class="kePublic">
					<!--转盘效果开始-->
					<div>
						<div class="banner">
							<div class="turnplate" style="background-image:url('http://img1.gtimg.com/autoguangzhou/pics/hv1/171/110/207/13488396.png');background-size:100% 100%;">
								<canvas class="item" id="wheelcanvas" width="528" height="528"></canvas>
								<img src="http://img1.gtimg.com/autoguangzhou/pics/hv1/169/110/207/13488394.png" alt="" id="go">
								<img id="tupBtn" class="pointer" src="http://img1.gtimg.com/autoguangzhou/pics/hv1/170/110/207/13488395.png">
							</div>
						</div>
					</div>
					<!--转盘效果结束-->
					<div class="clear"></div>
				</div>
			</div>
		</div>
	</body>
	<script src="http://dongguan.auto.qq.com/js/publicJS/jquery.min.js"></script>
	<script src="http://guangzhou.auto.qq.com/2017web/awardRotate.js"></script>
	<!--抽奖-->
	<script>
		//报名初始化 报名成功后变为true
		var bmFlag = false,name,phone,identity,model;
        $('#button').click(function(){
            var flag = true;
            if (flag) {
					name = $('#name').val(),
					phone = $('#phone').val(),
					identity=$('#identity').val(),
					model=$('#model').val();
	                var Data = {
	                    name: name,
	                    phone: phone,
	                    identity:identity,
	                    model:model
	                };
	                if(!name.match(/^[\u4e00-\u9fa5]{1,4}$/i)){
	                    alert('请输入正确的中文名');
	                    return false;
	                };
	                if(!RegExp(/^(0|86|17951)?(13[0-9]|15[012356789]|17[0-9]|18[0-9]|14[57])[0-9]{8}$/).test(phone)) {
	                    alert('手机格式不正确');
	                    return false;
	                }
					if(identity == 0){
	                    alert('请选择身份');
	                    return false;
	                   }
	                if(model == 0){
	                    alert('请选择车型');
	                    return false;
	                   }
	                flag = false;
	              $.ajax({
	                  type:"get",
	                  url: "http://www.yetcar.com/index.php?s=/Home/SpringTravel/springTravel_baoming",
	                  data:Data,
	                  async:true,
	                  dataType:"jsonp",
	                  success:function(data){
	                      if(data.status==1){
	                          alert('恭喜你，报名成功！');
                              bmFlag = true;
                              $('.baoming').fadeOut(300);
                              $('.luck').fadeIn(300);
	                      }else{
	                          flag = true;
	                          alert("很抱歉，你报名失败。");
	                      }
	                  }
	              });
            } else {
                alert('请勿重复报名!')
            }
        });
        //抽奖初始化
        var turnplate={
            restaraunts:[],				//大转盘奖品名称
            colors:[],	                //大转盘奖品区块对应背景颜色
            outsideRadius:210,			//大转盘外圆的半径
            textRadius:165,				//大转盘奖品位置距离圆心的距离
            insideRadius:50,			//大转盘内圆的半径
            startAngle:0,				//开始角度
            bRotate:false				//false:停止;ture:旋转
        };
        $(document).ready(function(){
            //动态添加大转盘的奖品与奖品区域背景颜色
            turnplate.restaraunts = [ "谢谢参与", "幸福春节红包1个", "谢谢参与", "1000元购车抵用券1张", "幸福春节红包1个", "1000元购车抵用券1张"];
            turnplate.colors = ["transparent"];
            //旋转转盘 item:奖品位置; txt：提示语;
            var rotateFn = function (item, txt){
                var angles = item * (360 / turnplate.restaraunts.length) - (360 / (turnplate.restaraunts.length*2));
                if(angles<270){
                    angles = 270 - angles;
                }else{
                    angles = 360 - angles + 270;
                }
                $('#wheelcanvas').stopRotate();
                $('#wheelcanvas').rotate({
                    angle:0,
                    animateTo:angles+1800,
                    duration:6000,
                    callback:function (){
                        //中奖页面弹窗
                        if(txt.indexOf("谢谢参与")>=0){
                            alert('谢谢参与！')
                            window.location.href = location.href+'?time='+((new Date()).getTime())
                        }
                        if (txt.indexOf("幸福春节红包1个")>=0) {
                            alert('恭喜你获得幸福春节红包1个！')
                            window.location.href = location.href+'?time='+((new Date()).getTime())
                        }
                        if (txt.indexOf("1000元购车抵用券1张")>=0) {
                            alert('恭喜你获得购车抵用券1000元1张！')
                            window.location.href = location.href+'?time='+((new Date()).getTime())
                        }
                        turnplate.bRotate = !turnplate.bRotate;
                    }
                });
            };

            /********抽奖开始**********/
            $('.banner').click(function () {
                if(turnplate.bRotate)return;
                turnplate.bRotate = !turnplate.bRotate;
                //判断报名
                if (bmFlag) {
                    var Data = {
                        phone: phone,
                        pid: 8
                    };
                    $.ajax({
                        type:"get",
                        url: "http://www.yetcar.com/index.php?s=/Home/SpringTravel/springTravel_luck",
                        data:Data,
                        async:true,
                        dataType:"jsonp",
                        success:function(data){
                            if(data.status==1){
                                var luckID = data.data.gift_id;

                                //幸福红包    购物卷    谢谢参与
                                var arrx = [2,5],arrg = [4,6],arrs = [1,3],item;
                                if (luckID == 38) {
                                    item = arrx[Math.floor((Math.random()*arrx.length))]
                                } else if (luckID == 39) {
                                    item = arrg[Math.floor((Math.random()*arrg.length))]
                                } else {
                                    item = arrs[Math.floor((Math.random()*arrs.length))]
                                }
                                console.log(item);
                                console.log(data);
                                rotateFn(item, turnplate.restaraunts[item-1]);
                            }
                            else{
                                alert('您的手机号已经参加过活动了！')
                                window.location.href = location.href+'?time='+((new Date()).getTime())
                            }
                        }
                    });
                } else {
                    alert('请先报名！')
                }
            });
            $('#tupBtn').click(function (){
                if(turnplate.bRotate)return;
                turnplate.bRotate = !turnplate.bRotate;
                //判断报名
				if (bmFlag) {
                    var Data = {
                        phone: phone,
                        pid: 8
                    };
                    $.ajax({
                        type:"get",
                        url: "http://www.yetcar.com/index.php?s=/Home/SpringTravel/springTravel_luck",
                        data:Data,
                        async:true,
                        dataType:"jsonp",
                        success:function(data){
                            if(data.status==1){
                                var luckID = data.data.gift_id;

                                //幸福红包    购物卷    谢谢参与
                                var arrx = [2,5],arrg = [4,6],arrs = [1,3],item;
                                if (luckID == 38) {
                                    item = arrx[Math.floor((Math.random()*arrx.length))]
                                } else if (luckID == 39) {
                                    item = arrg[Math.floor((Math.random()*arrg.length))]
                                } else {
                                    item = arrs[Math.floor((Math.random()*arrs.length))]
                                }
                                console.log(item);
                                console.log(data);
                                rotateFn(item, turnplate.restaraunts[item-1]);
                            }
                            else{
                                alert('您的手机号已经参加过活动了！')
                                window.location.href = location.href+'?time='+((new Date()).getTime())
                            }
                        }
                    });
				} else {
				    alert('请先报名！')
				}
            })

        });

        //页面所有元素加载完毕后执行drawRouletteWheel()方法对转盘进行渲染
        window.onload=function(){
            drawRouletteWheel();
        };
        //绘制 canvas抽奖画布
        function drawRouletteWheel() {
            var canvas = document.getElementById("wheelcanvas");
            if (canvas.getContext) {
                //根据奖品个数计算圆周角度
                var arc = Math.PI / (turnplate.restaraunts.length/2);
                var ctx = canvas.getContext("2d");
                //在给定矩形内清空一个矩形
                ctx.clearRect(0,0,528,528);
                //strokeStyle 属性设置或返回用于笔触的颜色、渐变或模式
                ctx.strokeStyle = "transparent";
                //font 属性设置或返回画布上文本内容的当前字体属性
                ctx.font = 'bold 22px Microsoft YaHei';
                for(var i = 0; i < turnplate.restaraunts.length; i++) {
                    var angle = turnplate.startAngle + i * arc;
                    ctx.fillStyle = turnplate.colors[i];
                    ctx.beginPath();
                    //arc(x,y,r,起始角,结束角,绘制方向) 方法创建弧/曲线（用于创建圆或部分圆）
                    ctx.arc(264, 264, turnplate.outsideRadius, angle, angle + arc, false);
                    ctx.arc(264, 264, turnplate.insideRadius, angle + arc, angle, true);
                    ctx.stroke();
                    ctx.fill();
                    //锁画布(为了保存之前的画布状态)
                    ctx.save();

                    //----绘制奖品文字颜色----
                    ctx.fillStyle = "#fff";
                    var text = turnplate.restaraunts[i];
                    var line_height = 30;
                    //translate方法重新映射画布上的 (0,0) 位置
                    ctx.translate(264 + Math.cos(angle + arc / 2) * turnplate.textRadius, 264 + Math.sin(angle + arc / 2) * turnplate.textRadius);

                    //rotate方法旋转当前的绘图
                    ctx.rotate(angle + arc / 2 + Math.PI / 2);

                    /** 下面代码根据奖品类型、奖品名称长度渲染不同效果，如字体、颜色、图片效果。(具体根据实际情况改变) **/
                    if(text.indexOf("\n")>0){//换行
                        var texts = text.split("\n");
                        for(var j = 0; j<texts.length; j++){
                            ctx.font = j == 0?'bold 22px Microsoft YaHei':'bold 22px Microsoft YaHei';
                            //ctx.fillStyle = j == 0?'#FFFFFF':'#FFFFFF';
                            if(j == 0){
                                //ctx.fillText(texts[j]+"M", -ctx.measureText(texts[j]+"M").width / 2, j * line_height);
                                ctx.fillText(texts[j], -ctx.measureText(texts[j]).width / 2, j * line_height);
                            }else{
                                ctx.fillText(texts[j], -ctx.measureText(texts[j]).width / 2, j * line_height);
                            }
                        }
                    }else if(text.indexOf("\n") == -1 && text.length>6){//奖品名称长度超过一定范围
                        text = text.substring(0,6)+"||"+text.substring(6);
                        var texts = text.split("||");
                        for(var j = 0; j<texts.length; j++){
                            ctx.fillText(texts[j], -ctx.measureText(texts[j]).width / 2, j * line_height);
                        }
                    }else{
                        //在画布上绘制填色的文本。文本的默认颜色是黑色
                        //measureText()方法返回包含一个对象，该对象包含以像素计的指定字体宽度
                        ctx.fillText(text, -ctx.measureText(text).width / 2, 0);
                    }

                    //把当前画布返回（调整）到上一个save()状态之前
                    ctx.restore();
                    //----绘制奖品结束----
                }
            }
        }
	</script>
</html>
